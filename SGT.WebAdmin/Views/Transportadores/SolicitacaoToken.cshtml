
<ol class="breadcrumb page-breadcrumb">
    <li class="breadcrumb-item">Administrativo</li>
    <li class="breadcrumb-item active">Gestão Transportador</li>
    <li class="breadcrumb-item active">Solicitação de Token</li>
</ol>

<div class="subheader">
    <h1 class="subheader-title">
        <i class="subheader-icon fal fa-key"></i>Solicitação de Token
    </h1>
</div>

<section id="knockoutPesquisaSolicitacaoToken" class="panel">
    <div class="panel-container">
        <div class="panel-content">
            <button class="btn btn-default waves-effect waves-themed"
                    data-bind="click: ExibirFiltros.eventClick, id: ExibirFiltros.id">
                <i class="fal fa-filter"></i> <span>Pesquisar Solicitações</span>
            </button>

            <div data-bind="id: ExibirFiltros.idFade, fadeVisible: ExibirFiltros.visibleFade">
                <form class="mt-3">
                    <div class="row">
                        <div class="col-12 col-md-6" data-bind="visible: Descricao.visible">
                            <div class="form-group">
                                <label class="form-label"
                                       data-bind="text: Descricao.text"></label>
                                <input type="text"
                                       class="form-control"
                                       data-bind="class: Descricao.requiredClass, value: Descricao.val, valueUpdate: 'afterkeydown', attr: { maxlength: Descricao.maxlength, id : Descricao.id}" />
                            </div>
                        </div>

                        <div class="col-12 col-md-6"
                             data-bind="visible: NumeroProtocolo.visible">
                            <div class="form-group">
                                <label class="form-label"
                                       data-bind="text: NumeroProtocolo.text"></label>
                                <input type="text"
                                       class="form-control"
                                       data-bind="class: NumeroProtocolo.requiredClass, value: NumeroProtocolo.val, valueUpdate: 'afterkeydown', attr: { maxlength: NumeroProtocolo.maxlength, id : NumeroProtocolo.id}" />
                            </div>
                        </div>
                    </div>

                    <div class="row"
                         data-bind="id: BuscaAvancada.idFade, fadeVisible: BuscaAvancada.visibleFade"></div>
                </form>
                <div class="row">
                    <div class="d-flex gap-2 justify-content-end">
                        <button class="btn btn-default"
                                type="button"
                                data-bind="click: BuscaAvancada.eventClick, attr: { id: BuscaAvancada.id}, visible: BuscaAvancada.visible">
                            <i data-bind="attr: { class: BuscaAvancada.icon}"
                               class="fal fa-plus"></i>
                            <span data-bind="text: BuscaAvancada.text"></span>
                        </button>
                        <button class="btn btn-primary"
                                type="button"
                                data-bind="click: Pesquisar.eventClick, attr: { id: Pesquisar.id}">
                            <i class="fal fa-search"></i>
                            <span data-bind="text: Pesquisar.text"></span>
                        </button>
                    </div>
                    <div class="mt-2">
                        <table width="100%"
                               class="table table-bordered table-hover"
                               id="grid-pesquisa-SolicitacaoToken"
                               cellspacing="0"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="panel">
    <div class="panel-hdr">
        <h2>Cadastro da Solicitação de Token para Integração</h2>
    </div>
    <div class="panel-container">
        <div class="panel-content">
            <div id="knockoutEtapasSolicitacaoToken">
                <ul class="nav nav-steps">
                    <li data-target="#step1" data-bind=" visible : Etapa1.visible">
                        <button data-bs-target="#etapaSolicitacao"
                                data-bs-toggle="tab"
                                data-bind="attr: {id : Etapa1.idTab }, click : Etapa1.eventClick, visible : Etapa1.visible">
                            <span class="step"
                                  data-bind="attr: {'data-content' : Etapa1.tooltip, 'data-original-title' : Etapa1.tooltipTitle }, text: Etapa1.step"></span>
                            <span class="title" data-bind="text: Etapa1.text"></span>
                        </button>
                    </li>
                    <li data-target="#step2" data-bind="visible : Etapa2.visible">
                        <button data-bs-target="#etapaAprovacao"
                                data-bs-toggle="tab"
                                data-bind="attr: {id : Etapa2.idTab }, click : Etapa2.eventClick">
                            <span class="step"
                                  data-bind="attr: {'data-content' : Etapa2.tooltip, 'data-original-title' : Etapa2.tooltipTitle }, text: Etapa2.step"></span>
                            <span class="title" data-bind="text: Etapa2.text"></span>
                        </button>
                    </li>
                    <li data-target="#step3" data-bind="visible : Etapa3.visible">
                        <button data-bs-target="#etapaLiberacaoSistemica"
                                data-bs-toggle="tab"
                                data-bind="attr: {id : Etapa3.idTab }, click : Etapa3.eventClick">
                            <span class="step"
                                  data-bind="attr: {'data-content' : Etapa3.tooltip, 'data-original-title' : Etapa3.tooltipTitle }, text: Etapa3.step"></span>
                            <span class="title" data-bind="text: Etapa3.text"></span>
                        </button>
                    </li>
                    <li data-target="#step4" data-bind="visible : Etapa4.visible">
                        <button data-bs-target="#etapaFinalizacao"
                                data-bs-toggle="tab"
                                data-bind="attr: {id : Etapa4.idTab }, click : Etapa4.eventClick">
                            <span class="step"
                                  data-bind="attr: {'data-content' : Etapa4.tooltip, 'data-original-title' : Etapa4.tooltipTitle }, text: Etapa4.step"></span>
                            <span class="title" data-bind="text: Etapa4.text"></span>
                        </button>
                    </li>
                </ul>
            </div>

            <div id="tabContentEtapas" class="tab-content p-3">
                <div class="tab-pane fade active show" id="etapaSolicitacao">
                    <div id="tabsEtapaSolicitacao">
                        <ul class="nav nav-tabs">
                            <li id="tabCadastro" class="nav-item">
                                <a href="#knockoutSolicitacaoTokenCadastro"
                                   class="nav-link active"
                                   data-bs-toggle="tab"
                                   aria-expanded="true">
                                    <i class="fal fa-file-alt"></i>
                                    <span class="hidden-xs">Cadastro</span>
                                </a>
                            </li>
                            <li id="tabTransportadores" class="nav-item">
                                <a href="#knockoutSolicitacaoTokenTransportadores"
                                   class="nav-link"
                                   data-bs-toggle="tab"
                                   aria-expanded="false">
                                    <i class="fal fa-building"></i>
                                    <span class="hidden-xs">Transportadores</span>
                                </a>
                            </li>
                            <li id="tabPermissoesWebService" class="nav-item">
                                <a href="#tabPermissoesWS"
                                   class="nav-link"
                                   data-bs-toggle="tab"
                                   aria-expanded="false">
                                    <i class="fal fa-unlock"></i>
                                    <span class="hidden-xs">Permissões WebService</span>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-content border border-top-0 p-3"
                         id="etapaSolicitacaoContentTabs">
                        <div class="tab-pane fade active show"
                             id="knockoutSolicitacaoTokenCadastro">
                            <h3 class="position-relative">Cadastro da Solicitação</h3>
                            <form>
                                <div class="row mt-5">
                                    <div class="col-12 col-md-3"
                                         data-bind="visible: NumeroProtocolo.visible">
                                        <div class="form-group">
                                            <label class="form-label"
                                                   data-bind="text: NumeroProtocolo.text"></label>
                                            <input type="text"
                                                   class="form-control"
                                                   data-bind="enable: NumeroProtocolo.enable, class: NumeroProtocolo.requiredClass, value: NumeroProtocolo.val, valueUpdate: 'afterkeydown', attr: { maxlength: NumeroProtocolo.maxlength, id : NumeroProtocolo.id}" />
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-2"
                                         data-bind="visible: DataInicioVigencia.visible">
                                        <div class="form-group">
                                            <label class="form-label"
                                                   data-bind="text: DataInicioVigencia.text"></label>
                                            <input type="text"
                                                   class="form-control"
                                                   data-bind="enable: DataInicioVigencia.enable, class: DataInicioVigencia.requiredClass, value: DataInicioVigencia.val, valueUpdate: 'afterkeydown', attr: { maxlength: DataInicioVigencia.maxlength, id : DataInicioVigencia.id}" />
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-2"
                                         data-bind="visible: DataFimVigencia.visible">
                                        <div class="form-group">
                                            <label class="form-label"
                                                   data-bind="text: DataFimVigencia.text"></label>
                                            <input type="text"
                                                   class="form-control"
                                                   data-bind="enable: DataFimVigencia.enable, class: DataFimVigencia.requiredClass, value: DataFimVigencia.val, valueUpdate: 'afterkeydown', attr: { maxlength: DataFimVigencia.maxlength, id : DataFimVigencia.id}" />
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-3"
                                         data-bind="visible: Descricao.visible">
                                        <div class="form-group">
                                            <label class="form-label"
                                                   data-bind="text: Descricao.text"></label>
                                            <input type="text"
                                                   class="form-control"
                                                   data-bind="enable: Descricao.enable, class: Descricao.requiredClass, value: Descricao.val, valueUpdate: 'afterkeydown', attr: { maxlength: Descricao.maxlength, id : Descricao.id}" />
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-2"
                                         data-bind="visible: TipoAutenticacao.visible">
                                        <div class="form-group">
                                            <label class="form-label"
                                                   data-bind="text: TipoAutenticacao.text, attr: { for: TipoAutenticacao.id }"></label>
                                            <select class="form-control"
                                                    data-bind="enable: TipoAutenticacao.enable, class: TipoAutenticacao.requiredClass, options: TipoAutenticacao.options, optionsText: 'text', optionsValue: 'value', value: TipoAutenticacao.val, attr: { maxlength: TipoAutenticacao.maxlength, id : TipoAutenticacao.id}, event:{change: TipoAutenticacao.eventChange}"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4" data-bind="visible: TempoExpiracao.visible">
                                    <div class="form-group">
                                        <label class="form-label" data-bind="text: TempoExpiracao.text"></label>
                                        <input type="text" class="form-control" data-bind="class: TempoExpiracao.requiredClass, value: TempoExpiracao.val, valueUpdate: 'afterkeydown', attr: { maxlength: TempoExpiracao.maxlength, id : TempoExpiracao.id}" />
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="tab-pane fade"
                             id="knockoutSolicitacaoTokenTransportadores">
                            <div class="card">
                                <div class="card-header d-flex align-items-center justify-content-between">
                                    <h3 class="card-title">Transportadores</h3>
                                    <button class="btn btn-primary waves-effect waves-themed"
                                            type="button"
                                            data-bind="enable: Transportadores.enable, visible: Transportadores.visible, attr: { id: Transportadores.idBtnSearch, text: Transportadores.text }">
                                        <i class="fal fa-plus"></i><span data-bind="text: Transportadores.text"></span>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <table width="100%"
                                           class="table table-bordered table-hover"
                                           data-bind="attr: { id: Transportadores.idGrid }"
                                           cellspacing="0"></table>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="tabPermissoesWS">
                            <div class="card">
                                <div id="knockoutSolicitacaoTokenPermissoesWS">
                                    <div class="card-header d-flex align-items-center justify-content-between">
                                        <h3 class="card-title" data-bind="text: Grid.text"></h3>
                                    </div>

                                    <div class="card-body">
                                        <table width="100%"
                                               class="table table-bordered table-hover"
                                               data-bind="attr: { id: Grid.idGrid }"
                                               cellspacing="0"></table>

                                        <div class="row mt-5">
                                            <div class="col-12 col-md-3"
                                                 data-bind="fadeVisible: !TodosMetodosLiberados.val()">
                                                <div class="form-group">
                                                    <label class="form-label"
                                                           data-bind="text: Metodo.text, attr: { for: Metodo.id }"></label>
                                                    <div class="input-group">
                                                        <input type="text"
                                                               class="form-control"
                                                               data-bind="enable: Metodo.enable, css: Metodo.requiredClass, value: Metodo.val, valueUpdate: 'afterkeydown', attr: { maxlength: Metodo.maxlength, id : Metodo.id}" />
                                                        <div class="input-group-append">
                                                            <button class="btn btn-primary waves-effect waves-themed"
                                                                    data-bind="enable: Metodo.enable, attr: { id: Metodo.idBtnSearch }"
                                                                    type="button"
                                                                    aria-label="Buscar">
                                                                <i class="fal fa-search"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-3"
                                                 data-bind="fadeVisible: !TodosMetodosLiberados.val()">
                                                <div class="form-group">
                                                    <label class="form-label"
                                                           data-bind="text: RequisicoesMinuto.text"></label>
                                                    <input type="text"
                                                           class="form-control"
                                                           data-bind="enable: RequisicoesMinuto.enable, class: RequisicoesMinuto.requiredClass, value: RequisicoesMinuto.val, valueUpdate: 'afterkeydown', attr: { maxlength: RequisicoesMinuto.maxlength, id : RequisicoesMinuto.id }" />
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-3"
                                                 data-bind="fadeVisible: !TodosMetodosLiberados.val()">
                                                <div class="form-group">
                                                    <label class="form-label"
                                                           data-bind="text: QuantidadeRequisicoes.text"></label>
                                                    <input type="text"
                                                           class="form-control"
                                                           data-bind="enable: QuantidadeRequisicoes.enable, class: QuantidadeRequisicoes.requiredClass, value: QuantidadeRequisicoes.val, valueUpdate: 'afterkeydown', attr: { maxlength: QuantidadeRequisicoes.maxlength, id : QuantidadeRequisicoes.id}" />
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12"
                                                 data-bind="fadeVisible: TodosMetodosLiberados.visible">
                                                <div class="form-group">
                                                    <div class="custom-control custom-checkbox">
                                                        <input type="checkbox"
                                                               class="custom-control-input"
                                                               data-bind="enable: TodosMetodosLiberados.enable, checked: TodosMetodosLiberados.val, attr: { maxlength: TodosMetodosLiberados.maxlength, name: TodosMetodosLiberados.id, id: TodosMetodosLiberados.id }" />
                                                        <label class="custom-control-label"
                                                               data-bind="text: TodosMetodosLiberados.text, attr: { for: TodosMetodosLiberados.id }"></label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-footer">
                                    <div id="knockoutCRUDSolicitacaoTokenPermissoesWS">
                                        <div class="row mt-2">
                                            <div class="col-6 d-flex justify-content-start">
                                                <button class="btn btn-default"
                                                        type="button"
                                                        data-bind="click: Limpar.eventClick, attr: { id: Limpar.id}">
                                                    <i class="fal fa-ban"></i><span data-bind="text: Limpar.text"></span>
                                                </button>
                                            </div>
                                            <div class="col-6 d-flex gap-2 justify-content-end">
                                                <button class="btn btn-primary waves-effect waves-themed"
                                                        type="button"
                                                        data-bind="enable: Adicionar.enable, click: Adicionar.eventClick, attr: { id: Adicionar.idBtnSearch, text: Adicionar.text }, visible: Adicionar.visible">
                                                    <i class="fal fa-plus"></i><span data-bind="text: Adicionar.text"></span>
                                                </button>
                                                <button class="btn btn-primary waves-effect waves-themed"
                                                        type="button"
                                                        data-bind="enable: Atualizar.enable, click: Atualizar.eventClick, attr: { id: Atualizar.idBtnSearch, text: Atualizar.text }, visible: Atualizar.visible">
                                                    <span data-bind="text: Atualizar.text"></span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="etapaAprovacao">
                    <div id="knockouEtapaAprovacaoToken">
                        <div data-bind="visible: PossuiRegras.val">
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <div class="panel">
                                        <div class="panel-hdr">
                                            <h2>Solicitação</h2>
                                        </div>
                                        <div class="panel-container">
                                            <div class="panel-content">
                                                <div class="panel-body">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <label class="form-label">
                                                                <span data-bind="text: DataSolicitacao.text"></span><span data-bind="text: DataSolicitacao.val"></span>
                                                            </label>
                                                        </div>
                                                        <div class="col-12">
                                                            <label class="form-label">
                                                                <span data-bind="text: AprovacoesNecessarias.text"></span><span data-bind="text: AprovacoesNecessarias.val"></span>
                                                            </label>
                                                        </div>
                                                        <div class="col-12">
                                                            <label class="form-label">
                                                                <span data-bind="text: Aprovacoes.text"></span><span data-bind="text: Aprovacoes.val"></span>
                                                            </label>
                                                        </div>
                                                        <div class="col-12">
                                                            <label class="form-label">
                                                                <span data-bind="text: Reprovacoes.text"></span><span data-bind="text: Reprovacoes.val"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="panel">
                                        <div class="panel-hdr">
                                            <h2>Autorizadores da Solicitação</h2>
                                        </div>
                                        <div class="panel-container">
                                            <div class="panel-content">
                                                <div class="panel-body">
                                                    <div class="row">
                                                        <table width="100%"
                                                               class="table table-bordered table-hover"
                                                               data-bind="attr: {id: Grid.id}"
                                                               cellspacing="0"></table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div data-bind="visible: !PossuiRegras.val()">
                            <div class="alert alert-warning">
                                Não foi encontrada nenhuma regra de aprovação.<br />
                                A solicitação ficará pendente até existir alguma regra de
                                aprovação. Clique em reprocessar regras para verificar.
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button class="btn btn-warning"
                                    type="button"
                                    data-bind="click: ReprocessarRegras.eventClick, attr: { id: ReprocessarRegras.id}">
                                <i class="fal fa-sync"></i><span data-bind="text: ReprocessarRegras.text"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="etapaLiberacaoSistemica" class="tab-pane fade">
                    <div id="LiberacaoSitemica">
                        <ul class="nav nav-tabs">
                            <li id="tabCadastro" class="nav-item">
                                <a href="#knockoutTokens"
                                   class="nav-link active"
                                   data-bs-toggle="tab"
                                   aria-expanded="true">
                                    <i class="fal fa-file-alt"></i>
                                    <span class="hidden-xs">Cadastro</span>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-content border border-top-0 p-3"
                         id="LiberacaoSitemicaContentTabs">
                        <div class="tab-pane fade active show" id="knockoutTokens">
                            <div class="row">
                                <table width="100%"
                                       class="table table-bordered table-hover"
                                       data-bind="attr: {id: Grid.idGrid}"
                                       cellspacing="0"></table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="etapaFinalizacao" class="tab-pane fade">
                    <div class="row">
                        <h3>Finalização</h3>
                        <p>Geração de token finalizado com sucesso.</p>
                    </div>
                </div>
            </div>

            <div id="knockoutCRUDSolicitacaoToken" class="row mt-3">
                <div class="col-6 d-flex justify-content-start">
                    <button class="btn btn-default"
                            type="button"
                            data-bind="click: LimparTudo.eventClick, attr: { id: LimparTudo.id}">
                        <i class="fal fa-ban"></i><span data-bind="text: LimparTudo.text"></span>
                    </button>
                </div>
                <div class="col-6 d-flex justify-content-end">
                    <button class="btn btn-success"
                            type="button"
                            data-bind="visible: Adicionar.visible, click: Adicionar.eventClick, attr: { id: Adicionar.id}">
                        <span data-bind="text: Adicionar.text"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>



<div id="divModalDetalhesAutorizacaoSolicitacaoToken" class="modal fade" role="dialog" aria-hidden="true">
    <div id="knockoutDetalheAutorizacaoToken" class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Detalhes da Autorização</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true">
                    <i class="fal fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row row-cols-1 row-cols-md-2">
                    <div class="col">
                        <table class="table table-clean table-sm align-self-end">
                            <tbody>
                                <tr>
                                    <td>
                                        <strong data-bind="text: Regra.text"></strong>

                                        <span data-bind="text: Regra.val"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong data-bind="text: Situacao.text"></strong>

                                        <span data-bind="text: Situacao.val"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong data-bind="text: Usuario.text"></strong>

                                        <span data-bind="text: Usuario.val"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong data-bind="text: Data.text"></strong>

                                        <span data-bind="text: Data.val"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong data-bind="text: Motivo.text"></strong>

                                        <span data-bind="text: Motivo.val"></span>
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="~/scripts/SolicitacaoToken"></script>
<script src="~/scripts/cte"></script>
<script src="~/scripts/controleSaldo"></script>
<script src="~/scripts/dropzone"></script>
<script src="~/scripts/cartaCorrecao"></script>

<script type="text/javascript">

    pageSetUp();

    $(document).ready(function () {
        loadSolicitacaoToken();
    });

</script>


const DEFAULTS = { threshold: 2, maximumItems: 5, highlightTyped: !0, highlightClass: "text-primary", label: "label", value: "value", showValue: !1, showValueBeforeLabel: !1 }; class Autocomplete { constructor(e, t) { this.field = e, this.options = Object.assign({}, DEFAULTS, t), this.dropdown = null, e.parentNode.classList.add("dropdown"), e.setAttribute("data-bs-toggle", "dropdown"), e.classList.add("dropdown-toggle"); let i = ce('<div class="dropdown-menu"></div>'); this.options.dropdownClass && i.classList.add(this.options.dropdownClass), insertAfter(i, e), this.dropdown = new bootstrap.Dropdown(e, this.options.dropdownOptions), e.addEventListener("click", e => { 0 === this.createItems() && (e.stopPropagation(), this.dropdown.hide()) }), e.addEventListener("input", () => { this.options.onInput && this.options.onInput(this.field.value), this.renderIfNeeded() }), e.addEventListener("keydown", e => { if (27 === e.keyCode) { this.dropdown.hide(); return } if (40 === e.keyCode) { this.dropdown._menu.children[0]?.focus(); return } }) } setData(e) { this.options.data = e, this.renderIfNeeded() } renderIfNeeded() { this.createItems() > 0 ? this.dropdown.show() : this.field.click() } createItem(e, t) { let i; if (this.options.highlightTyped) { let s = removeDiacritics(t.label).toLowerCase().indexOf(removeDiacritics(e).toLowerCase()), o = Array.isArray(this.options.highlightClass) ? this.options.highlightClass.join(" ") : "string" == typeof this.options.highlightClass ? this.options.highlightClass : ""; i = t.label.substring(0, s) + `<span class="${o}">${t.label.substring(s, s + e.length)}</span>` + t.label.substring(s + e.length, t.label.length) } else i = t.label; return this.options.showValue && (this.options.showValueBeforeLabel ? i = `${t.value} ${i}` : i += ` ${t.value}`), ce(`<button type="button" class="dropdown-item" data-label="${t.label}" data-value="${t.value}">${i}</button>`) } createItems() { let e = this.field.value; if (e.length < this.options.threshold) return this.dropdown.hide(), 0; let t = this.field.nextSibling; t.innerHTML = ""; let i = Object.keys(this.options.data), s = 0; for (let o = 0; o < i.length; o++) { let n = i[o], l = this.options.data[n], a = { label: this.options.label ? l[this.options.label] : n, value: this.options.value ? l[this.options.value] : l }; if (removeDiacritics(a.label).toLowerCase().indexOf(removeDiacritics(e).toLowerCase()) >= 0 && (t.appendChild(this.createItem(e, a)), this.options.maximumItems > 0 && ++s >= this.options.maximumItems)) break } return this.field.nextSibling.querySelectorAll(".dropdown-item").forEach(e => { e.addEventListener("click", e => { let t = e.currentTarget.getAttribute("data-label"), i = e.currentTarget.getAttribute("data-value"); this.field.value = t, this.options.onSelectItem && this.options.onSelectItem({ value: i, label: t }), this.dropdown.hide() }) }), t.childNodes.length } } function ce(e) { let t = document.createElement("div"); return t.innerHTML = e, t.firstChild } function insertAfter(e, t) { return t.parentNode.insertBefore(e, t.nextSibling) } function removeDiacritics(e) { return e.normalize("NFD").replace(/[\u0300-\u036f]/g, "") }
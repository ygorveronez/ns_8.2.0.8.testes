(function(n){function l(n){return n?(n=n.replace(/^.*#/,""),isNaN(n))?-1:+n:-1}function a(){var n=location.hash;return l(n)}function b(n){o.push(n);h+=n.data.length}function v(n){for(i=0;i<o.length;i++){var t=o[i];if(n<t.data.length+t.offset)return t}return 0}function k(n,t){return t-n.offset}function e(n,t,i){var r,u;t.pause();t.settings.enableHistory||(r=l(i.href),r>=0&&(u=k(t,r),u>=0&&t.goto(u)),n.preventDefault())}function s(){var t=a(),n,i;t<0||(n=v(t),n)&&(i=t-n.offset,n.goto(i))}function d(){if(!c){c=!0;var i=location.hash;r=i;n.browser.msie?r==""&&(r="#"):n.browser.safari&&(t=[],t.length=history.length,f=[],u=!0);setInterval(function(){g()},100)}}function g(){var e,i,h,o;if(n.browser.safari){if(!w)if(e=history.length-t.length,e){if(u=!1,e<0)for(i=0;i<Math.abs(e);i++)f.unshift(t.pop());else for(i=0;i<e;i++)t.push(f.shift());h=t[t.length-1];h!=undefined&&(r=location.hash,s())}else t[t.length-1]!=undefined||u||(s(),u=!0)}else o=location.hash,o!=r&&(r=o,s())}var y;document.write("<style type='text/css'>.noscript{display:none}<\/style>");var p="galleriffic-1.0",h=0,o=[],r,t,f,u=!1,w=!1,c=!1;y={delay:3e3,numThumbs:20,preloadAhead:40,enableTopPager:!1,enableBottomPager:!0,imageContainerSel:"",captionContainerSel:"",controlsContainerSel:"",loadingContainerSel:"",renderSSControls:!0,renderNavControls:!0,playLinkText:"Play",pauseLinkText:"Pause",prevLinkText:"Previous",nextLinkText:"Next",nextPageLinkText:"Next &rsaquo;",prevPageLinkText:"&lsaquo; Prev",enableHistory:!1,autoStart:!1,onChange:undefined,onTransitionOut:undefined,onTransitionIn:undefined,onPageTransitionOut:undefined,onPageTransitionIn:undefined};n.fn.galleriffic=function(t,r){var u,s;n.extend(this,{ver:function(){return p},initializeThumbs:function(){this.data=[];var t=this;return this.$thumbsContainer.find("ul.thumbs > li").each(function(i){var u=n(this),r=u.find("a.thumb"),f=t.offset+i;t.data.push({title:r.attr("title"),slideUrl:r.attr("href"),caption:u.find(".caption").remove(),hash:f});r.attr("rel","history");r.attr("href","#"+f);r.click(function(n){e(n,t,this)})}),this},isPreloadComplete:!1,preloadInit:function(){if(this.settings.preloadAhead==0)return this;this.preloadStartIndex=this.currentIndex;var n=this.getNextIndex(this.preloadStartIndex);return this.preloadRecursive(this.preloadStartIndex,n)},preloadRelocate:function(n){return this.preloadStartIndex=n,this},preloadRecursive:function(n,t){var e,f,r,i,u;return n!=this.preloadStartIndex?(e=this.getNextIndex(this.preloadStartIndex),this.preloadRecursive(this.preloadStartIndex,e)):(f=this,r=t-n,r<0&&(r=this.data.length-1-n+t),this.settings.preloadAhead>=0&&r>this.settings.preloadAhead)?(setTimeout(function(){f.preloadRecursive(n,t)},500),this):(i=this.data[t],!i)?this:i.image?this.preloadNext(n,t):(u=new Image,u.onload=function(){i.image=this;f.preloadNext(n,t)},u.alt=i.title,u.src=i.slideUrl,this)},preloadNext:function(n,t){var i=this.getNextIndex(t),r;return i==n?this.isPreloadComplete=!0:(r=this,setTimeout(function(){r.preloadRecursive(n,i)},100)),this},getNextIndex:function(n){var t=n+1;return t>=this.data.length&&(t=0),t},getPrevIndex:function(n){var t=n-1;return t<0&&(t=this.data.length-1),t},pause:function(){return this.interval&&this.toggleSlideshow(),this},play:function(){return this.interval||this.toggleSlideshow(),this},toggleSlideshow:function(){if(this.interval)clearInterval(this.interval),this.interval=0,this.$controlsContainer&&this.$controlsContainer.find("div.ss-controls a").removeClass().addClass("play").attr("title",this.settings.playLinkText).attr("href","#play").html(this.settings.playLinkText);else{this.ssAdvance();var n=this;this.interval=setInterval(function(){n.ssAdvance()},this.settings.delay);this.$controlsContainer&&this.$controlsContainer.find("div.ss-controls a").removeClass().addClass("pause").attr("title",this.settings.pauseLinkText).attr("href","#pause").html(this.settings.pauseLinkText)}return this},ssAdvance:function(){var n=this.getNextIndex(this.currentIndex),t=this.data[n].hash;return this.settings.enableHistory?location.href="#"+t:this.goto(n),this},goto:function(n){if(n<0?n=0:n>=this.data.length&&(n=this.data.length-1),this.settings.onChange)this.settings.onChange(this.currentIndex,n);return this.currentIndex=n,this.preloadRelocate(n),this.refresh()},refresh:function(){var t=this.data[this.currentIndex],i;if(!t)return this;var r=!0,n=this,u=function(){r=!1;n.$controlsContainer&&n.$controlsContainer.find("div.nav-controls a.prev").attr("href","#"+n.data[n.getPrevIndex(n.currentIndex)].hash).end().find("div.nav-controls a.next").attr("href","#"+n.data[n.getNextIndex(n.currentIndex)].hash);var t=n.data[n.currentIndex];n.$captionContainer&&n.$captionContainer.empty().append(t.caption);t.image?n.buildImage(t.image):n.$loadingContainer&&n.$loadingContainer.show()};if(this.settings.onTransitionOut)this.settings.onTransitionOut(u);else this.$transitionContainers.hide(),u();return t.image||(i=new Image,i.onload=function(){t.image=this;r||n.buildImage(t.image)},i.alt=t.title,i.src=t.slideUrl),this.relocatePreload=!0,this.syncThumbs()},buildImage:function(n){if(this.$imageContainer){this.$imageContainer.empty();var t=this,i=this.getNextIndex(this.currentIndex);this.$loadingContainer&&this.$loadingContainer.hide();this.$imageContainer.append('<span class="image-wrapper"><a class="advance-link" rel="history" href="#'+this.data[i].hash+'" title="'+n.alt+'"><\/a><\/span>').find("a").append(n).click(function(n){e(n,t,this)})}return this.settings.onTransitionIn?this.settings.onTransitionIn():this.$transitionContainers.show(),this},syncThumbs:function(){var n,t;return this.$thumbsContainer&&(n=Math.floor(this.currentIndex/this.settings.numThumbs),n!=this.currentPage&&(this.currentPage=n,this.updateThumbs()),t=this.$thumbsContainer.find("ul.thumbs").children(),t.filter(".selected").removeClass("selected"),t.eq(this.currentIndex).addClass("selected")),this},updateThumbs:function(){var n=this,t=function(){n.rebuildThumbs();n.settings.onPageTransitionIn?n.settings.onPageTransitionIn():n.$thumbsContainer.show()};if(this.settings.onPageTransitionOut)this.settings.onPageTransitionOut(t);else this.$thumbsContainer.hide(),t();return this},rebuildThumbs:function(){var u,t,i,f,r,e;return this.currentPage<0&&(this.currentPage=0),u=this.data.length>this.settings.numThumbs,t=this.$thumbsContainer.find("div.top"),t.length==0&&(t=this.$thumbsContainer.prepend('<div class="top pagination"><\/div>').find("div.top")),u&&this.settings.enableTopPager&&(t.empty(),this.buildPager(t)),u&&this.settings.enableBottomPager&&(i=this.$thumbsContainer.find("div.bottom"),i.length==0?i=this.$thumbsContainer.append('<div class="bottom pagination"><\/div>').find("div.bottom"):i.empty(),this.buildPager(i)),f=this.currentPage*this.settings.numThumbs,r=f+this.settings.numThumbs-1,r>=this.data.length&&(r=this.data.length-1),e=this.$thumbsContainer.find("ul.thumbs"),e.find("li").each(function(t){var i=n(this);t>=f&&t<=r?i.show():i.hide()}),e.removeClass("noscript"),this},buildPager:function(n){var s=this,u=this.currentPage*this.settings.numThumbs,f,t,o,r;for(this.currentPage>0&&(f=u-this.settings.numThumbs,n.append('<a rel="history" href="#'+this.data[f].hash+'" title="'+this.settings.prevPageLinkText+'">'+this.settings.prevPageLinkText+"<\/a>")),i=this.currentPage-3;i<=this.currentPage+3;i++)t=i+1,i==this.currentPage?n.append('<span class="current">'+t+"<\/span>"):i>=0&&i<this.numPages&&(o=i*this.settings.numThumbs,n.append('<a rel="history" href="#'+this.data[o].hash+'" title="'+t+'">'+t+"<\/a>"));return r=u+this.settings.numThumbs,r<this.data.length&&n.append('<a rel="history" href="#'+this.data[r].hash+'" title="'+this.settings.nextPageLinkText+'">'+this.settings.nextPageLinkText+"<\/a>"),n.find("a").click(function(n){e(n,s,this)}),this}});this.settings=n.extend({},y,r);this.interval&&clearInterval(this.interval);this.interval=0;this.settings.imageContainerSel&&(this.$imageContainer=n(this.settings.imageContainerSel));this.settings.captionContainerSel&&(this.$captionContainer=n(this.settings.captionContainerSel));this.settings.loadingContainerSel&&(this.$loadingContainer=n(this.settings.loadingContainerSel));this.$transitionContainers=n([]);this.$imageContainer&&(this.$transitionContainers=this.$transitionContainers.add(this.$imageContainer));this.$captionContainer&&(this.$transitionContainers=this.$transitionContainers.add(this.$captionContainer));this.offset=h;this.$thumbsContainer=n(t);this.initializeThumbs();b(this);this.numPages=Math.ceil(this.data.length/this.settings.numThumbs);this.currentPage=-1;this.currentIndex=0;u=this;this.$loadingContainer&&this.$loadingContainer.hide();this.settings.controlsContainerSel&&(this.$controlsContainer=n(this.settings.controlsContainerSel).empty(),this.settings.renderSSControls&&(this.settings.autoStart?this.$controlsContainer.append('<div class="ss-controls"><a href="#pause" class="pause" title="'+this.settings.pauseLinkText+'">'+this.settings.pauseLinkText+"<\/a><\/div>"):this.$controlsContainer.append('<div class="ss-controls"><a href="#play" class="play" title="'+this.settings.playLinkText+'">'+this.settings.playLinkText+"<\/a><\/div>"),this.$controlsContainer.find("div.ss-controls a").click(function(n){return u.toggleSlideshow(),n.preventDefault(),!1})),this.settings.renderNavControls&&(s=this.$controlsContainer.append('<div class="nav-controls"><a class="prev" rel="history" title="'+this.settings.prevLinkText+'">'+this.settings.prevLinkText+'<\/a><a class="next" rel="history" title="'+this.settings.nextLinkText+'">'+this.settings.nextLinkText+"<\/a><\/div>").find("div.nav-controls a").click(function(n){e(n,u,this)})));d();var f=a(),o=f>=0?v(f):0,c=o&&this==o?f-this.offset:0;return this.goto(c),this.settings.autoStart&&setTimeout(function(){u.play()},this.settings.delay),setTimeout(function(){u.preloadInit()},1e3),this}})(jQuery);